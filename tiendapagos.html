<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="csscarpinteria.css">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link href="tiendacategoriacocina.html">
        <title> Carrito </title>
    </head>
    <body style="margin: 0%;background-image: url('https://images.unsplash.com/photo-1531824475211-72594993ce2a?fm=jpg&q=60&w=3000&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxleHBsb3JlLWZlZWR8MXx8fGVufDB8fHx8fA%3D%3D');">
        <ul>
            <li class="menu"><a href="tiendavirtual.html">Inicio</a></li>
            <li class="menu"><a href="tiendavirtualcategorias.html">Categorias</a></li>
            <li class="menu"><a href="tiendavirtualofertas.html">Ofertas</a></li>
            <li class="menu"><a href="tiendavirtualcontacto.html">Contacto</a></li>
            <li class="menu"><a href="tiendapagos.html"><i class="bx bx-cart"></i></a></li>
            </ul>
            <div style="border: 5px solid black;"></div>
<header>
    <div class="Carrito" style="height: auto; width: fit-content; background-color: aliceblue; border: 3px solid black; margin-top: 10px; margin-left: 800px;">
        <h2 class="titulo-carro">Carrito</h2>
        <i class='bx bx-cart' id="logo-carro"></i>
        <div class="Contenido">

            <div class="caja-carro">
            <div class="detalle-caja">
            <div class="producto-carro-titulo"></div>
            <div class="precio-carro"></div>
            <input type="number" value="1" class="Cantidad">
        </div>

        <!--remover-->
        <i class='bx bx-trash-alt remover-carro'></i>
    </div>
    </div>
    <div class="total">
        <div class="titulo-total">Total</div>
        <div class="precio total">$2900</div>
    </div>
    <button type="button" class="btnComprar">Comprar</button>
    <i class="bx bx-shopping-bag"></i>
    <i class='bx bx-x' id="cerrar-carro"></i>
</header>
<script>

    let carrito = [];
    const contenedorCarro = document.querySelector('.contenido-carro');
    const iconoCarro = document.getElementById('logo-carro');
    const cerrarCarro = document.getElementById('cerrar-carro');
    const totalCarro = document.querySelector('.precio-total');
    const botonCompra = document.querySelector('.btn-compra');


    iconoCarro.addEventListener('click', () => {
        document.querySelector('.carro').classList.toggle('active');
    });
    cerrarCarro.addEventListener('click', () => {
        document.querySelector('.carro').classList.remove('active');
    });


    function agregarAlCarro(titulo, precio, imgSrc) {
        const productoExistente = carrito.find(prod => prod.titulo === titulo);
        if (productoExistente) {
            productoExistente.cantidad++;
        } else {
            carrito.push({ titulo, precio, imgSrc, cantidad: 1 });
        }
        actualizarCarro();
    }


    function actualizarCarro() {
        contenedorCarro.innerHTML = '';
        let total = 0;
        carrito.forEach((producto, index) => {
            total += producto.precio * producto.cantidad;

            const productoCarro = document.createElement('div');
            productoCarro.classList.add('caja-carro');
            productoCarro.innerHTML =`
            <img src="${producto.imgSrc}" class="carro-img">
                    <div class="detalle-caja">
                        <div class="producto-carro-titulo">${producto.titulo}</div>
                        <div class="precio-carro">$${producto.precio}</div>
                        <input type="number" min="1" value="${producto.cantidad}" class="cantidad-carro">
                    </div>
                    <i class='bx bx-trash-alt remover-carros'></i>
                `;

            productoCarro.querySelector('.remover-carros').addEventListener('click', () => {
                eliminarProducto(index);
            });
            productoCarro.querySelector('.cantidad-carro').addEventListener('change', (e) => {
                cambiarCantidad(index, e.target.value);
            });
            contenedorCarro.appendChild(productoCarro);
        });
        totalCarro.textContent = '$${total}';
    }

    function cambiarCantidad(index, nuevaCantidad) {
        carrito[index].cantidad = parseInt(nuevaCantidad);
        actualizarCarro();
    }


    function eliminarProducto(index) {
        carrito.splice(index, 1);
        actualizarCarro();
    }


    botonCompra.addEventListener('click', () => {
        if (carrito.length > 0) {
            alert('¡Gracias por su compra!');
            carrito = [];
            actualizarCarro();
        } else {
            alert('El carrito está vacío.');
        }
    });


    document.querySelectorAll('.bx-shopping-bag').forEach((icono, index) => {
        icono.addEventListener('click', () => {
            const producto = icono.parentElement;
            const titulo = producto.querySelector('.titulo-producto').textContent;
            const precio = parseFloat(producto.querySelector('.precio').textContent.replace('$', ''));
            const imgSrc = producto.querySelector('.img-producto').src;
            agregarAlCarro(titulo, precio, imgSrc);
        });
    });
    </script>
</body>
</html>